<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gioco Dinosauro Custom - Trefin Edition</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(to top, #ccefff 0%, #e6f7ff 100%);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  canvas {
    display: block;
    margin: 0 auto;
    background: #fff;
    border: 2px solid #444;
    box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
  }
</style>
</head>
<body>
<canvas id="game" width="900" height="250"></canvas>

<script>
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  // Dinosauro come sprite semplice: un rettangolo con una testa
  const dino = {
    x: 60,
    y: 190,
    width: 40,
    height: 40,
    yVelocity: 0,
    gravity: 0.6,
    jumpPower: -14,
    onGround: true,
  };

  // Nuvole con scritta "trefin"
  const clouds = [];
  const cloudSpeed = 0.8;

  function createCloud() {
    const y = 40 + Math.random() * 50;
    clouds.push({ x: canvas.width + 50, y });
  }

  // Ostacoli cactus stilizzati
  const obstacles = [];
  const obstacleSpeed = 7;

  function createObstacle() {
    obstacles.push({ x: canvas.width, y: 190, width: 20, height: 40 });
  }

  let frameCount = 0;
  let gameOver = false;
  let score = 0;
  let highScore = localStorage.getItem('dinoHighScore') || 0;

  // Suoni semplici con Web Audio API
  const AudioContext = window.AudioContext || window.webkitAudioContext;
  const audioCtx = new AudioContext();

  function playSound(type) {
    if (!audioCtx) return;
    let oscillator = audioCtx.createOscillator();
    let gainNode = audioCtx.createGain();
    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);

    if (type === 'jump') {
      oscillator.type = 'triangle';
      oscillator.frequency.setValueAtTime(600, audioCtx.currentTime);
      gainNode.gain.setValueAtTime(0.15, audioCtx.currentTime);
      oscillator.start();
      oscillator.stop(audioCtx.currentTime + 0.1);
    } else if (type === 'hit') {
      oscillator.type = 'square';
      oscillator.frequency.setValueAtTime(200, audioCtx.currentTime);
      gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
      oscillator.start();
      oscillator.stop(audioCtx.currentTime + 0.3);
    }
  }

  // Disegna dinosauro stilizzato
  function drawDino() {
    // Corpo
    ctx.fillStyle = '#444';
    ctx.fillRect(dino.x, dino.y, dino.width, dino.height);

    // Testa (cerchio)
    ctx.beginPath();
    ctx.fillStyle = '#666';
    ctx.arc(dino.x + dino.width - 10, dino.y + 10, 10, 0, Math.PI * 2);
    ctx.fill();

    // Occhio
    ctx.beginPath();
    ctx.fillStyle = 'white';
    ctx.arc(dino.x + dino.width - 7, dino.y + 8, 4, 0, Math.PI * 2);
    ctx.fill();

    ctx.beginPath();
    ctx.fillStyle = 'black';
    ctx.arc(dino.x + dino.width - 7, dino.y + 8, 2, 0, Math.PI * 2);
    ctx.fill();
  }

  // Nuvola con testo
  function drawCloud(cloud) {
    // Nuvola stilizzata
    ctx.fillStyle = '#ddd';
    ctx.beginPath();
    ctx.ellipse(cloud.x, cloud.y, 30, 20, 0, 0, Math.PI * 2);
    ctx.ellipse(cloud.x + 30, cloud.y + 10, 25, 18, 0, 0, Math.PI * 2);
    ctx.ellipse(cloud.x + 60, cloud.y, 30, 20, 0, 0, Math.PI * 2);
    ctx.fill();

    // Scritta "trefin"
    ctx.fillStyle = '#888';
    ctx.font = 'bold 18px Arial';
    ctx.fillText('trefin', cloud.x + 15, cloud.y + 6);
  }

  // Disegna cactus
  function drawObstacle(ob) {
    ctx.fillStyle = '#2a7f2a';
    // corpo cactus
    ctx.fillRect(ob.x + 5, ob.y + 10, 10, 30);
    // braccio sinistro
    ctx.fillRect(ob.x, ob.y + 20, 10, 10);
    // braccio destro
    ctx.fillRect(ob.x + 15, ob.y + 20, 10, 10);
  }

  function update() {
    if (gameOver) return;

    frameCount++;

    // Movimento dinosauro
    dino.yVelocity += dino.gravity;
    dino.y += dino.yVelocity;

    if (dino.y > 190) {
      dino.y = 190;
      dino.yVelocity = 0;
      dino.onGround = true;
    }

    // Nuvole
    if (frameCount % 160 === 0) {
      createCloud();
    }
    clouds.forEach((cloud, index) => {
      cloud.x -= cloudSpeed;
      if (cloud.x < -80) clouds.splice(index, 1);
    });

    // Ostacoli
    if (frameCount % 100 === 0) {
      createObstacle();
    }
    obstacles.forEach((ob, index) => {
      ob.x -= obstacleSpeed;

      // Collisione
      if (
        dino.x < ob.x + 20 &&
        dino.x + dino.width > ob.x &&
        dino.y < ob.y + 40 &&
        dino.y + dino.height > ob.y
      ) {
        gameOver = true;
        playSound('hit');

        // Aggiorna record
        if (score > highScore) {
          highScore = score;
          localStorage.setItem('dinoHighScore', highScore);
        }
      }

      if (ob.x < -40) obstacles.splice(index, 1);
    });

    score++;
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Sfondo cielo (lineare giÃ  nel body)
    // Terra
    ctx.fillStyle = '#745c25';
    ctx.fillRect(0, 230, canvas.width, 20);

    // Nuvole
    clouds.forEach(drawCloud);

    // Dinosauro
    drawDino();

    // Ostacoli
    obstacles.forEach(drawObstacle);

    // Punteggio
    ctx.fillStyle = '#333';
    ctx.font = '22px Consolas, monospace';
    ctx.fillText('Score: ' + score, 730, 30);
    ctx.fillText('Record: ' + highScore, 730, 60);

    if (gameOver) {
      ctx.fillStyle = 'red';
      ctx.font = '48px Arial Black';
      ctx.fillText('GAME OVER', 320, 120);
      ctx.font = '24px Arial';
      ctx.fillText('Premi R per riprovare', 320, 160);
    }
  }

  function gameLoop() {
    update();
    draw();
    if (!gameOver) {
      requestAnimationFrame(gameLoop);
    }
  }

  // Controlli
  window.addEventListener('keydown', (e) => {
    if ((e.code === 'Space' || e.code === 'ArrowUp') && dino.onGround && !gameOver) {
      dino.yVelocity = dino.jumpPower;
      dino.onGround = false;
      playSound('jump');
    }

    if (gameOver && e.code === 'KeyR') {
      // Reset gioco
      score = 0;
      frameCount = 0;
      obstacles.length = 0;
      clouds.length = 0;
      dino.y = 190;
      dino.yVelocity = 0;
      dino.onGround = true;
      gameOver = false;
      gameLoop();
    }
  });

  // Inizia gioco
  gameLoop();
</script>
</body>
</html>

